<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
		<title>检查情况-正常</title>
	</head>
	<link rel="stylesheet" href="../css/base.css">
	<link rel="stylesheet" href="../css/bootstrap.css">
	<link rel="stylesheet" href="../css/task_css/wpjc.css">
	<link rel="stylesheet" href="../css/weui.min.css">

	<body>
		<div id="app">
			<div class="title">
				<p>
					识别码：{{deviceDetails.qrCode}}
					<span onclick="fn()">
						历史检查<img src="../imgs/task_img/right.png" alt="">
                    </span>
				</p>
			</div>
			<div class="mhq clearfix">
				<div class="box">
					<img src="../imgs/task_img/mhq.png" alt="">
				</div>
				<div class="box_1">
					<p>
						{{deviceDetails.materialName}}
						<span>检查规范</span>
					</p>
					<p>位置：{{deviceDetails.location}} </p>
					<p>生产日期：{{deviceDetails.producedDate}}</p>
					<p>过期日期：{{deviceDetails.expireDate}}</p>
				</div>
			</div>
			<div class="jcqk">
				<ul>
					<li v-for="(item,index) in deviceDetails.checkSpecificItems">
						<p v-text="item.name"></p>
						<span @click="checkBtns(0,index)" v-bind:class="!inspectStatusArr[index]?'checked':''">正常</span>
						<span @click="checkBtns(1,index)" v-bind:class="inspectStatusArr[index]==1?'checked':''">异常</span>
					</li>
				</ul>
			</div>
			<p v-if="inspectStatus" class="shangbao" @click="selectCheifs" >
			    <img src="../imgs/task_img/sanj.png" alt="">
			    上报上级
			    <span>
			         <label v-text="cheifsName"></label>
			         <img src="../imgs/task_img/right.png" alt="">
			    </span>
			</p>
			<!--情况描述-->
			<div class="miaosu">
				<p>
					情况描述
				</p>
				<textarea v-model="descr" name="备注" id="" cols="10" rows="5" placeholder="请输入检查情况描述..."></textarea>
			</div>
			<!--添加照片-->
			<div class="pic">
				<p>
					现场照片/视频
				</p>
				<div class="tianjia">
					<img src="../imgs/index_img/jiah.png" alt="">
				</div>
			</div>
			<button @click="submitInfo">提交</button>
		</div>
	</body>
	<script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="../js/vue.min.js"></script>
	<script type="text/javascript" src="../js/axios.min.js"></script>
	<script type="text/javascript" src="../js/fetchData.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
	<script type="text/javascript" src="../js/weui.min.js"></script>
	<script>
		let data = {
			data: {},
			url: '/app/user/info'
		}

		var myvue = new Vue({
			el: '#app',
			data: {
				deviceDetails: JSON.parse(decodeURIComponent(decodeURI(getQueryString("deviceDetails")))),
			    checkSpecificItmes: {},
			    inspectStatusArr: [],
			    inspectStatus: false,
			    descr: "",
			    photos: [],
			    cheifsName: "请选择",
			    cheifsId: "",
			},
			created() {
				let that = this;
//				that.getCheckSpecificItmes();
			},
			methods: {
				getCheckSpecificItmes: function() {
					let that = this;
					let data = {
						data: {
							id: "",
						},
						url: '/app/check/specific/query?materialTypeId=1' , //+ that.deviceDetails.checkSpecificId
						method: 'get'
					}

					fetchData(data).then(res => {
						if(res.data.code == 200) {
							that.checkSpecificItmes = res.data.list;
						}
						console.log(res);
					});
				},
				checkBtns: function(status,id) {
					var that = this
					Vue.set(that.inspectStatusArr, id, status);
					if(that.inspectStatusArr.indexOf(1)>=0) {
						that.inspectStatus = true;
					} else {
						that.inspectStatus = false;
					}
				},
				submitInfo: function() {
					let that = this;
					let data = {
						data: {
							materialId:that.deviceDetails.id,
							regionId: that.deviceDetails.regionId,
							status: '0',
							inspectStatus: that.inspectStatusArr.indexOf(1)>=0?1:0,
							chiefIds: that.cheifsId,
							photos: ['33','333'],
							descr: that.descr,
						},
						url: '/app/material/check', 
						method: 'POST'
					}

					fetchData(data).then(res => {
						if(res.data.code == 200) {
							console.log(res);
//							window.location.href = "../index/index.html"
						}
						console.log(res);
					});
				},
				selectCheifs:function() {
					var that = this
					var weData = that.deviceDetails.cheifs.map(o=>{return{value:o.id, label:o.name}});
					weui.picker(
					   weData,{
						   className: 'custom-classname',
						   container: 'body',
						   onChange: function (result) {
					   },
					   onConfirm: function (result) {
					   	   that.cheifsName = result[0].label;
					   	   that.cheifsId = result[0].value;
					   },
					   id: 'cheifs'
					});
				}
			}
		});
	</script>
	<script>
		function fn() {
			window.location.href = "jcjl.html?materialId=" + myvue.deviceDetails.id
		}
	</script>

</html>